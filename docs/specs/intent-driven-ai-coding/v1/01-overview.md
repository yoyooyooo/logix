---
title: 意图驱动的声明式 AI 编码体系 · 总览
status: draft
version: v1
---

> 本文给出一套**可独立理解**的高层方案，用来描述：在以 toB 管理系统为主的前端团队中，如何围绕「意图 → 模式 → 模板」组织 AI 辅助编码与出码前工具。

## 0. 背景与原始诉求（精简版）

这一套规划并不是为了一般意义上的“低代码平台”，而是基于以下前提：

- **LLM 优先**：如果没有今天这样的 LLM，仅靠 Intent/Pattern/Template/YAML 只是在给人类增加负担；
  真正的目标是：让 LLM 在面对未知需求时，有一套结构化的“跑道”可以沿着 Intent → Pattern → Plan → Flow/Effect 稳定工作。
- **意图为起点**：开发者面对新场景时，理想方式是只需要把需求讲清楚（自然语言），在平台的帮助下把它变成结构化 Intent，
  后续的模式选择、Plan 生成、行为编排和代码骨架落地尽量由 LLM + 内核协作完成。
- **IMD / best-practice 是养分，不是圣经**：现有 IMD 仓库和 best-practice 仓库提供的是组件库、文件/状态规范和代码片段，
  它们是平台实现 Intent/Pattern/Flow 的“供体”，可以随着意图体系的成熟被调整或升级（包括在行为层逐步引入 Effect/Flow）。
- **行为层要有自己的 SSoT**：Zustand + TanStack Query 已经很好地承载了“状态”和“缓存”，
  但对于跨 Store/跨 Service 的行为（导出、审批、批量任务等），我们希望通过 Flow DSL + Effect 程序 + `.flow.ts` 文件
  建立一个独立的“行为层事实来源”，便于平台和 LLM 长期维护、解释与重构。

在这个背景下，本体系的唯一“神圣不可侵犯”的东西，不是某个具体库或规范仓库，而是：  
**能在真实工程里持续提供提效价值的、以意图为中心的人机协同开发流水线。**

## 1. 要解决的核心问题

在典型的 AI 辅助编码实践中，常见问题包括：

- 开发者的真实意图（业务目标、交互需求、场景结构）散落在脑子、需求文档和对话里，很难成为可复用资产。
- 模板和脚手架变成“高级复制粘贴”：只负责铺代码，不说明“适用什么场景、为什么这样写”。
- AI 频繁被当做“生成一段代码”的工具，而不是和开发者一起维护设计决策图的同伴。

目标是：

> 让「意图」在整个开发过程里成为一等公民，  
> 让「模式库」沉淀可复用的编码套路，  
> 让「模板」只是模式在具体技术栈下的实现，  
> AI 和工具都围绕这三者工作，而不是反过来。

## 2. 意图层级（L0–L4）

为了避免一上来就掉进实现细节，我们把信息分成五个层级：

- **L0：目标与约束（Why）**
  - 业务目标、性能/安全/合规等非功能约束。
  - 例：“提升运营处理效率 30%”“必须支持 1440 + 窄屏”“沿用现有权限体系”。
- **L1：场景结构（What – 场景视角）**
  - 页面类型、用户流程、主要入口/出口。
  - 例：“任务工作台：左侧任务列表 + 右侧详情”“三步向导表单”。
- **L2：模式（What – 设计/编码视角）**
  - 可跨多个业务场景复用的交互/编码模式。
  - 例：“列表 + 详情模式”“分页表格 + 服务器过滤”“工作台布局（左 tabs + 指标 + 右详情）”。
- **L3：领域与数据契约（What – 领域视角）**
  - 实体与字段、状态机、接口形态。
  - 例：“Task 含 id/status/assignee…；列表接口返回分页结构”；“状态从待处理 → 处理中 → 已完成”。
- **L4：实现与技术约束（How – 实现视角）**
 - 技术栈、框架、组件库、状态管理、代码组织方式。
  - 例：“React + 某组件库 + 某状态库；列表用通用 Table 组件封装”。

约定：

- 意图资产至少覆盖 L1–L3，尽量带关键 L0 信息。
- 模板/代码主要在 L4，但必须声明“自己是为哪些 L2 模式服务”的。

## 2.x 当前默认落地环境（说明）

本规划在设计时尽量保持与具体技术栈解耦，但在当前阶段，我们主要服务于团队内部的这套组合环境：

- IMD 组件库仓库：`/Users/yoyo/projj/git.imile.com/ux/imd`
- best-practice 规范与片段仓库：`/Users/yoyo/projj/git.imile.com/ux/best-practice`

这两者提供了：

- UI 组件与注册表（IMD）
- 文件类型与目录约定、状态管理与组件设计规范
- 服务层 / 适配器 / Query / 测试等代码片段与 LLM 模板（best-practice）

需要强调的是：

- Intent / Pattern / Template / Plan 仍然是本体系的核心抽象，尽量保持“实现无关”；
- IMD 与 best-practice 是当前阶段的默认实现土壤和养分，而不是高于 Intent 的“终极规范源”；
- 当实现方式或技术栈在未来演进时，优先调整的是“如何在新环境下承接这些 Intent/Pattern”，而不是推翻 Intent 本身。

## 3. 三个一等公民：意图 / 模式 / 模板

在这套体系中，一切围绕三个概念展开：

1. **意图（Intent）**
   - 某个功能或模块“想要达成什么效果”的结构化表达。
   - 包含：目标、场景结构、所选模式、关键数据契约。
2. **模式（Pattern）**
   - 一段可复用的“编码思路 + 最佳实践 + 反模式”。
   - 描述“某类交互/需求在不同业务下应该怎么写”，刻意不带具体业务名词或文件路径。
3. **模板（Template）**
   - 在具体技术栈中对一个或多个模式的实现。
   - 负责落盘代码、配置、测试，是对模式的“物理实现”。

高层关系可以概括为：

```text
意图（Intent） → 选择/组合模式（Pattern） → 选择/组合模板（Template） → 生成/演进代码
```

需要强调的是：上述三者都**站在现有技术栈与组件库之上**工作，而不是替代它们。更完整的视角是：

```text
设计系统 & 组件库  ←  模式运行时实现  ←  模板/Plan  ←  模式/意图
```

- 设计系统 & 基础组件：提供表格、表单、布局、弹层等可复用 UI 能力。
- 模式：规定在这些能力之上如何拆分“代码角色”（例如 TableComponent / FilterStore / ListQueryHook 等），以及推荐的组织方式。
- 模板：在具体工程中，把模式定义的角色映射为实际组件/文件和目录结构。
- 意图：描述业务需求选择哪些模式，并为这些模式提供实体/接口/配置等参数。

## 4. 出码前 vs 运行时

在以 toB 管理系统为主的前端团队中，我们刻意区分：

- **出码前（类似低代码）世界**
  - 意图资产：对功能/场景的结构化描述。
  - 模式库：可复用的编码模式说明及约束。
  - 模板元数据：模板实现了哪些模式、需要哪些参数、有哪些变体。
  - 出码计划：基于意图+模式+模板推导出的“生成/修改文件计划”。
  - 工具与平台：意图编辑器、模式库管理界面、生成控制台、CLI 等。
- **出码后（运行时）世界**
  - 生成出来的页面、组件、Hook、Store 等业务代码。
  - 通用运行时库：表格/表单/状态/权限/错误处理等。
  - 模式的 UI/逻辑实现：标准工作台布局、列表+详情容器等。

约束：

- 出码前所有决策应尽量沉淀为意图资产 + 模式选择 + 出码计划；
- 出码前的平台内核可以使用 Effect/DI 等技术栈实现（详见 `05-effect-ts-integration.md`），
  但出码后的业务项目仍采用常规 React/TS 栈，不强制使用同样的内核技术；
- 运行时代码可以局部偏离，但重大变更建议回写到意图层。

## 5. 角色与分工（聚焦 toB 管理后台团队）

在本方案的默认假设下，**平台的直接使用者是前端开发**。产品/运营等需求方通过文档、会议等形式提供输入，由前端在平台中整理为意图资产。  
角色大致分为三类（其中“产品”角色目前由前端暂代）：

- **前端业务开发**
  - 兼任“产品（前端暂代）”角色，负责：
    - 基于外部需求输入，描述业务目标（L0）、场景结构（L1）、关键业务流程；
    - 在意图工作台中创建和维护意图草稿，与 AI 一起澄清需求与约束；
    - 选择和配置模式（L2）、补全领域与数据契约（L3）；
    - 审阅并确认出码计划，触发生成/更新代码。
- **前端架构师 / 平台前端**
  - 负责：
    - 维护模式库、模板清单及其参数契约、生成规则；
    - 定义“什么场景可以自动生成、什么场景必须手写”的边界；
    - 审阅关键 Intent / Pattern / Template 变更，保证整体一致性。
- **产品角色（概念上的）**
  - 在成熟阶段，可由真正的产品/运营同学参与：
    - 在平台中参与或驱动 L0/L1 的意图录入；
    - 与前端一起在 Intent 层做权衡和确认。
  - 在过渡阶段，由前端业务开发代为履行。
- **AI 代理（平台的一部分）**
  - 负责：引导意图结构化、推荐模式、自动填充部分模板参数、给出解释与风险提示；
  - 不直接做最终决策，所有重要决策需体现在 Intent/Pattern/Plan 等结构化资产中。

## 6. 后续文档结构

本 v1 版本下的其他文档从不同角度展开：

- `02-patterns-and-intents.md`  
  详细定义模式库与意图资产的结构，给出示例和约束。
- `03-pre-code-vs-runtime.md`  
  明确哪些概念/资产属于出码前，哪些属于运行时，并结合 toB 管理系统做分类。
- `04-platform-design.md`  
  描述“意图/模式工作台”的形态：有哪些工作区、角色如何在其中协作、交付物如何流转。
- `05-effect-ts-integration.md`  
  讨论平台内核如何利用函数式 Effect/DI 框架承载能力抽象与生成管线（面向平台实现开发者，可选阅读）。
