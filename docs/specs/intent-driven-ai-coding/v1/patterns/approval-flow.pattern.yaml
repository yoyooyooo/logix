id: approval-flow
name: 审批流页面（待办 + 已办 + 详情 + 历史）
version: v1
status: draft
summary: 适用于需要“待办/已办/全部 + 审批详情 + 操作历史”的审批流场景，统一列表、详情与状态流转视图。

problem: >
  审批类功能（费用报销、权限申请、合同审批等）通常包含：
  1）待办/已办/全部列表；
  2）详情页展示申请信息与当前状态；
  3）操作历史（审批记录时间线）；
  4）审批动作（同意/拒绝/转交等）。
  如果每个审批模块自行实现，容易导致：
  - 列表与详情结构不统一；
  - 状态流转与历史展示方式不一致；
  - 权限检查与按钮显隐逻辑分散在各个组件中。
  approval-flow 模式提供一套“审批中心”页面的基本结构与角色划分，便于在多个审批场景复用。

applicability:
  goodFor:
    - 费用报销、权限申请、合同审批等典型审批流程
    - 需要统一“待办/已办/全部 + 详情 + 历史”的中后台审批中心
  badFor:
    - 简单二选一确认弹窗（不需要完整审批页面）
    - 强业务特化的复杂工作流引擎（建议在此模式基础上扩展）
  requiredSceneType:
    - approval
    - list-page

composition:
  roles:
    - id: ApprovalPageShell
      label: 审批中心页面壳
      description: >
        负责整体布局：上方 Tab（待办/已办/全部）、左侧列表、右侧详情与操作历史区域。
        内部组合列表/详情/历史组件，不直接处理具体审批业务逻辑。
      provides:
        - ApprovalPageShellService
    - id: ApprovalListComponent
      label: 审批列表组件
      description: >
        渲染当前 Tab 对应的审批任务列表（待办/已办/全部），支持基本筛选与排序，
        选中项改变时通过 ApprovalSelectionService 通知详情视图。
      requires:
        - ApprovalSelectionService
        - ApprovalQueryService
    - id: ApprovalDetailComponent
      label: 审批详情组件
      description: >
        展示当前选中任务的申请信息、当前状态与可执行按钮（同意/拒绝/转交等），
        调用 ApprovalActionService 执行动作，不直接封装 HTTP。
      requires:
        - ApprovalSelectionService
        - ApprovalActionService
    - id: ApprovalTimelineComponent
      label: 审批历史时间线组件
      description: >
        渲染审批记录时间线，展示每个节点的处理人、时间、动作与备注。
      requires:
        - ApprovalHistoryService

dataContract:
  description: >
    approval-flow 模式要求 Intent 在 domain 中至少描述：
    1）审批实体（如 ApprovalRequest）的字段（申请人、类型、状态、创建时间等）；
    2）列表接口（待办/已办/全部）及其筛选参数；
    3）详情接口与审批动作接口（同意/拒绝/转交等）；
    4）历史记录接口（审批记录列表）。

paramsSchema:
  entity:
    type: string
    required: true
    desc: 审批实体名称，例如 ApprovalRequest。
  tabs:
    type: array
    required: true
    item:
      type: string
      enum: [todo, done, all]
    desc: 需要展示的 Tab 列表（默认包含待办/已办/全部）。
  listPageSize:
    type: number
    required: false
    default: 20
    desc: 列表默认分页大小。
  showHistory:
    type: boolean
    required: false
    default: true
    desc: 是否在详情右侧/下方展示审批历史时间线。

uiSchema:
  entity:
    widget: select
    label: 审批实体
    optionsFrom: intent.domain.entities
  tabs:
    widget: checkbox-group
    label: Tab 选项
    options:
      - value: todo
        label: 待办
      - value: done
        label: 已办
      - value: all
        label: 全部
  listPageSize:
    widget: number-input
    label: 列表默认分页大小
  showHistory:
    widget: switch
    label: 显示审批历史时间线

examples:
  - name: 费用报销审批中心
    intentId: expense-approval-center
    description: >
      将费用报销审批场景统一抽象为“待办/已办/全部 + 详情 + 时间线”页面，
      列表部分可结合 table-with-server-filter 模式，详情与历史部分复用 approval-flow 约定的组件结构。
