id: table-with-server-filter
name: 服务端筛选表格
version: v1
status: draft
summary: 适用于 toB 管理系统中的分页列表场景，通过服务端筛选、分页和批量操作统一实现列表展示与导出能力。

problem: >
  在典型的管理后台中，订单、工单、用户等实体的管理界面通常需要：
  1）按多个字段进行筛选（状态、时间区间、关键字等）；
  2）展示可分页的列表并支持排序、列显隐；
  3）提供批量导出或批量操作能力。
  若每个页面从零开始实现这些能力，容易导致交互不一致、重复代码和维护困难。
  本模式旨在提供一套可复用的表格 + 筛选 + 批量操作实现套路。

applicability:
  goodFor:
    - 需要展示大规模数据的后台列表（订单、工单、用户、库存等）
    - 需要支持按多个字段筛选，并希望统一导出行为
    - 列表数据由服务端分页返回（非一次性加载全部）
  badFor:
    - 仅展示少量静态数据的小表格（此时不需要复杂模式）
    - 强流程型视图（应优先考虑“向导表单”等模式）
    - 需要复杂交互式聚合视图（建议使用专门的图表/仪表盘模式）
  requiredSceneType:
    - list-page
  preconditions:
    - 至少定义一个实体（entity），例如 Order
    - 至少存在一个支持分页与筛选参数的列表接口（list API）

composition:
  roles:
    - id: TableComponent
      label: 列表组件
      description: >
        组合 Query Hook、Filter Store、Table Store 和列配置，负责渲染数据表格、
        分页控件，并处理分页/排序/行点击等交互；不直接进行数据归一化。
      requires:
        - ListQueryService
        - TableUiStateService
    - id: ColumnsConfig
      label: 列配置
      description: >
        以数据结构形式定义表格列（key/title/sortable 等），由 TableComponent 引用；
        同时作为导出字段和列显隐配置的来源，避免重复定义。
    - id: FilterStore
      label: 筛选状态 Store
      description: >
        维护筛选区的 UI 状态（例如 status、日期区间、关键字等），提供 setter，
        不处理 HTTP 参数归一化逻辑。
      provides: FilterService
    - id: TableStore
      label: 表格 UI 状态 Store
      description: >
        维护分页、排序、列显隐等表格 UI 状态；不负责数据加载，仅提供状态与更新方法。
      provides: TableUiStateService
    - id: ListQueryHook
      label: 列表查询 Hook
      description: >
        负责调用列表接口，将 FilterStore 中的筛选状态和 TableStore 中的分页/排序状态
        映射为 HTTP 请求参数；同时负责处理 loading/错误/缓存等行为。
      provides: ListQueryService
      requires:
        - FilterService
        - TableUiStateService
    - id: ExportService
      label: 导出服务
      description: >
        （可选）根据当前筛选条件与列配置构造导出载荷并调用导出接口；不直接参与页面渲染。
      provides: ExportService

dataContract:
  requiredEntityFields:
    - id
    - status
  recommendedEntityFields:
    - createdAt
    - updatedAt
    - totalAmount
  listApi:
    description: "要求列表接口至少支持分页参数与可选筛选参数。"
    requiredQueryParams:
      - page
      - pageSize
    optionalQueryParams:
      - keyword
      - status
      - createdAtFrom
      - createdAtTo

paramsSchema:
  entity:
    type: string
    required: true
    desc: >
      绑定的实体名称，例如 Order。用于从 Intent 的实体定义中推导字段和默认列。
  pagination:
    type: boolean
    required: false
    default: true
    desc: 是否启用分页控件与 page/pageSize 状态。
  batchActions:
    type: array
    item:
      type: string
      enum: [export, bulkUpdate]
    required: false
    desc: 支持的批量操作类型（导出、批量更新等）。
  columns:
    type: array
    required: false
    item:
      type: object
      fields:
        key:
          type: string
          required: true
          desc: 绑定实体字段名。
        title:
          type: string
          required: true
          desc: 列头显示名称。
        sortable:
          type: boolean
          required: false
          default: false
          desc: 是否支持按该列排序。
  pageSize:
    type: number
    required: false
    default: 20
    desc: 默认每页条数。

uiSchema:
  entity:
    widget: select
    label: 绑定实体
    optionsFrom: intent.domain.entities
  pagination:
    widget: switch
    label: 启用分页
  batchActions:
    widget: checkbox-group
    label: 批量操作
    options:
      - value: export
        label: 导出
      - value: bulkUpdate
        label: 批量更新
  columns:
    widget: column-picker
    label: 列配置
    optionsFrom: intent.domain.entities[entity].fields
  pageSize:
    widget: number-input
    label: 默认每页条数

examples:
  - name: 订单管理列表
    intentId: order-management
    description: >
      对应 examples/feature-skeleton 中的订单管理功能。通过该模式生成列表组件、
      列配置、筛选状态 Store、表格 UI Store 和列表查询 Hook 等骨架。
