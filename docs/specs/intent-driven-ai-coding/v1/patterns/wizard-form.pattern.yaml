id: wizard-form
name: 多步向导表单
version: v1
status: draft
summary: 适用于跨多步收集复杂信息的场景，将表单拆分为多个步骤，并统一状态管理、导航与校验策略。

problem: >
  在 toB 管理系统中，复杂对象的创建/配置往往需要跨多步收集信息（例如创建活动、配置权限、设置价格规则等）。
  如果直接用一个长表单实现，容易出现：
  1）用户难以感知进度；
  2）前端难以管理局部校验和跨步依赖；
  3）状态散落在多个组件里，难以复用。
  wizard-form 模式提供一套多步表单的结构化约定：步骤定义、状态存储、导航行为与提交策略。

applicability:
  goodFor:
    - 创建/配置流程较长的场景（3 步及以上）
    - 每一步表单字段较多，且存在跨步依赖（例如前一步选项影响后一步字段）
  badFor:
    - 字段数量较少的简单表单（使用单页表单模式更简单）
    - 强工作流/审批类场景（建议结合 approval-flow 或专门流程模式）
  requiredSceneType:
    - wizard
    - form

composition:
  roles:
    - id: WizardShellComponent
      label: 向导壳组件
      description: >
        负责渲染整体步骤条（Step Indicator）、上一页/下一步/提交按钮，
        并根据当前步骤渲染对应的 StepFormComponent。
      provides:
        - WizardShell
    - id: StepFormComponent
      label: 步骤表单组件
      description: >
        每个步骤对应一个 StepFormComponent，负责渲染该步骤的字段，并通过 FormStateService
        读写向导状态。组件本身不直接管理跨步导航。
      requires:
        - FormStateService
    - id: FormStateStore
      label: 向导状态 Store
      description: >
        集中存储向导当前步、每步的字段值与校验状态，提供跳步/重置/提交等动作。
        可基于 Zustand 或其他状态库实现，但必须保持与表单组件解耦。
      provides:
        - FormStateService

dataContract:
  description: >
    wizard-form 模式不限定具体字段结构，但要求：
    1）Intent 中明确 steps 列表及每步的语义；
    2）在 domain.entities 中定义完整数据结构，便于生成默认字段配置；
    3）在 domain.apis 中定义创建/更新接口，用于最终提交。

paramsSchema:
  entity:
    type: string
    required: true
    desc: >
      绑定的实体名称，例如 Campaign、UserOnboarding。用于推导默认字段和提交载荷结构。
  steps:
    type: array
    required: true
    item:
      type: object
      fields:
        id:
          type: string
          required: true
          desc: 步骤标识（用于状态存储与导航）。
        title:
          type: string
          required: true
          desc: 步骤标题，用于显示在步骤条上。
        description:
          type: string
          required: false
          desc: 步骤简要说明。
        fields:
          type: array
          required: false
          item:
            type: string
          desc: 本步骤包含的实体字段名列表。
  allowBack:
    type: boolean
    required: false
    default: true
    desc: 是否允许用户返回上一页修改。
  allowSkip:
    type: boolean
    required: false
    default: false
    desc: 是否允许跳过可选步骤。

uiSchema:
  entity:
    widget: select
    label: 绑定实体
    optionsFrom: intent.domain.entities
  steps:
    widget: table-editor
    label: 步骤列表
    columns:
      - key: id
        label: 步骤标识
        widget: text-input
      - key: title
        label: 标题
        widget: text-input
      - key: description
        label: 说明
        widget: text-area
      - key: fields
        label: 字段列表
        widget: multi-select
        optionsFrom: intent.domain.entities[entity].fields
  allowBack:
    widget: switch
    label: 允许返回上一页
  allowSkip:
    widget: switch
    label: 允许跳过步骤

examples:
  - name: 活动创建向导
    intentId: campaign-wizard
    description: >
      将复杂的活动创建流程拆分为“基础信息 → 规则配置 → 权益设置 → 审核确认”四步，
      利用 wizard-form 管理步骤状态、字段聚合与最终提交。
