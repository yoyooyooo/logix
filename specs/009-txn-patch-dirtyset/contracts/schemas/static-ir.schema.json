{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://intent-flow.local/specs/009-txn-patch-dirtyset/schemas/static-ir.schema.json",
  "title": "StaticIR",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "moduleId", "nodes", "edges"],
  "properties": {
    "version": { "type": "string", "minLength": 1 },
    "moduleId": { "type": "string", "minLength": 1 },
    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["nodeId", "kind", "reads", "writes"],
        "properties": {
          "nodeId": { "type": "string", "minLength": 1 },
          "kind": { "type": "string", "minLength": 1 },
          "reads": { "type": "array", "items": { "$ref": "./field-path.schema.json" } },
          "writes": { "type": "array", "items": { "$ref": "./field-path.schema.json" } },
          "writesUnknown": { "type": "boolean" },
          "policy": { "type": "object", "additionalProperties": true },
          "meta": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "label": { "type": "string" },
              "tags": { "type": "array", "items": { "type": "string" } }
            }
          }
        }
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["edgeId", "from", "to", "kind"],
        "properties": {
          "edgeId": { "type": "string", "minLength": 1 },
          "from": { "type": "string", "minLength": 1 },
          "to": { "type": "string", "minLength": 1 },
          "kind": { "type": "string", "minLength": 1 }
        }
      }
    },
    "conflicts": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["code", "message"],
        "properties": {
          "code": { "type": "string", "minLength": 1 },
          "message": { "type": "string", "minLength": 1 },
          "fields": { "type": "array", "items": { "$ref": "./field-path.schema.json" } },
          "nodes": { "type": "array", "items": { "type": "string" } },
          "resolution": {
            "type": "object",
            "additionalProperties": false,
            "required": ["kind"],
            "properties": {
              "kind": { "type": "string" },
              "details": {
                "description": "Optional details about how the conflict was resolved. Must be JSON-serializable and slim."
              }
            }
          }
        }
      }
    }
  }
}
