# Quickstart: Devtools Session‑First（会话树 + Advisor）

**Feature**: `specs/038-devtools-session-ui/spec.md`  
**Created**: 2025-12-27

## ≤5 关键词（心智模型）

1. **会话（Session）**：一次入口触发到系统稳定的聚合单元；Devtools 默认入口。
2. **锚点（Anchors）**：把事件关联成链路的稳定 id（优先 `linkId`，退化 `txnId`）。
3. **脉冲（Pulses）**：一次会话内提交/渲染的时间分布；用于快速判断是否 waterfall/抖动。
4. **处方（Advisor）**：结论 + 证据 + 建议；不要求你读全量 timeline。
5. **退化可解释（Degrade‑Explain）**：证据不足时承认不确定（`confidence/degradedReason`），并提供下钻自证路径。

## 你能得到什么（用户视角）

- 进入 Devtools 先看到“最近会话列表/树”，每条会话直接给出健康信号（ok/warn/danger）与触发原因摘要。
- 点开会话后，在右侧工作台获得：
  - **概览**：入口/耗时/提交次数/渲染影响/范围摘要；
  - **Advisor**：优先级最高的 1–3 条可执行建议（每条都可点开证据）；
  - **下钻**：必要时切换到 Timeline / Inspector，且已自动过滤到会话范围。

## 粗粒度成本模型（你在为哪些成本买单）

- **提交次数（txn/commit）**：越多越像 waterfall；会放大渲染/派生/校验成本。
- **渲染影响（react impact）**：影响面越广，越可能出现“无关 render/联动抖动”。
- **退化次数**：越频繁说明锚点/证据不足（例如缺 `linkId` 或未知写入），需要先补齐可诊断性再谈优化。

## 优化梯子（从观察到行动）

1. **先看会话健康信号**：优先处理 danger/warn 会话，确认是“频率问题”还是“单次成本问题”。
2. **看脉冲分布**：提交/渲染是否集中在短时间爆发，还是被拉长成多次小提交（waterfall 典型特征）。
3. **按 Advisor 处方改动**：优先做“可局部验证”的改动（缩小写入影响域/减少提交次数/隔离不相关订阅）。
4. **必要时下钻自证**：用过滤后的 Timeline/Inspector 验证：入口→事务→关键证据事件是否和处方一致。

## 反模式（高概率导致“看不清/找不到”）

- 依赖时间窗聚合而没有稳定锚点（缺 `linkId`），导致交错链路被误合并或误切分。
- 把大量重对象塞进诊断 `meta` 导致裁剪/丢弃，从而证据不足、可信度下降。
- 只看 timeline 不看会话/处方，导致排障路线被噪音吞没（与本特性目标相反）。
