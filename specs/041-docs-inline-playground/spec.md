# Feature Specification: 文档内联教学 Playground

**Feature Branch**: `[041-docs-inline-playground]`  
**Created**: 2025-12-26  
**Status**: Draft  
**Input**: User description: "为用户文档增加在线运行 Playground（教学演示优先），读者可编辑代码后重新运行；高级/Debug 文档才展示 Timeline/Trace 等深度观测。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 一键运行教学示例并获得“可观察结果” (Priority: P1)

作为文档读者，我希望在阅读教程/指南时，能对作者标记的示例“一键运行”，并立即看到与讲解对应的关键结果（而不是只看静态代码），从而更快建立正确心智模型。

**Why this priority**: 这是教学演示的最小闭环；没有可运行与可观察结果，很多流程类/交互类文档只能停留在“看代码猜行为”。  

**Independent Test**: 在任意包含可运行示例的文档页中，读者无需离开页面即可完成一次运行，并能看到与该段落讲解对应的输出/状态摘要。

**Acceptance Scenarios**:

1. **Given** 文档页包含一个作者标记为“可运行”的示例块，**When** 读者点击运行，**Then** 示例被执行并在页面内展示运行结果（成功/失败、耗时、关键输出摘要）。
2. **Given** 示例运行失败（语法/运行时错误），**When** 读者查看结果，**Then** 页面给出可理解的错误摘要与定位信息，并提示如何恢复到可运行状态（例如重置到示例初始内容）。

---

### User Story 2 - 随意编辑并重新运行，用于“探索式学习” (Priority: P1)

作为文档读者，我希望可以在页面内直接编辑示例代码（或参数），并反复重新运行，从而通过“试错 + 观察”加深理解。

**Why this priority**: 教学场景里，学习效果往往来自“改一点点看看会怎样”；仅能运行但不能编辑，会迫使用户回到本地环境，断裂学习流。

**Independent Test**: 读者在不刷新页面、不离开文档的情况下，完成“编辑 → 运行 → 观察 → 再编辑 → 再运行”的循环，并可随时一键恢复到作者提供的初始示例。

**Acceptance Scenarios**:

1. **Given** 读者修改了示例内容，**When** 点击重新运行，**Then** 运行使用最新编辑内容，结果区域清晰区分“本次运行”输出，不混入上一次残留内容。
2. **Given** 读者把示例改坏导致无法运行，**When** 点击重置，**Then** 代码恢复到作者提供的初始版本并可再次成功运行。

---

### User Story 3 - 作者可声明“观察点”与默认面板，避免跑完不知道看什么 (Priority: P2)

作为文档作者，我希望对每个可运行示例声明 1–3 条“观察点”（运行后应该观察什么、如何判断是否符合预期），并选择默认展示的结果面板（教学默认简洁），从而让读者把注意力放在正确的输出与状态上。

**Why this priority**: 不是所有代码片段都有执行意义；即便可运行，读者也常常不知道“跑完应该看哪里”。作者声明观察点能把运行结果变成可学习的反馈。

**Independent Test**: 作者在一段文档中加入一个可运行示例，配置观察点与默认面板后，读者运行该示例时能在结果区看到对应提示与聚焦内容。

**Acceptance Scenarios**:

1. **Given** 作者为示例配置了观察点与默认面板，**When** 读者首次展开示例，**Then** 默认面板符合作者设置，并在结果区域展示观察点提示（例如“应看到 X”“应发生 Y”）。
2. **Given** 作者不提供观察点，**When** 读者运行示例，**Then** 系统仍提供一个最小的“结果摘要”与基础提示（例如成功/失败、耗时、控制台输出入口），避免空白反馈。

---

### User Story 4 - 高级/Debug 文档可按需启用深度观测 (Priority: P3)

作为高级用户或排障读者，我希望在特定的高级/Debug 文档中，作者可以按需启用更深的观测面板（例如时间线/Trace/事件摘要），用于解释“为什么会这样”，但普通教程默认不暴露这些复杂度。

**Why this priority**: 深度观测对高级内容很有价值，但对入门教程会产生认知负担；需要做到“按文档选择性启用”。

**Independent Test**: 同一站点内同时存在入门教程与高级调试文档：入门页只展示教学面板，高级页可看到额外的观测视图，且不影响其它页面的默认体验。

**Acceptance Scenarios**:

1. **Given** 一个普通教程示例块未开启高级观测，**When** 读者运行，**Then** 仅展示教学默认面板（例如说明/控制台/结果摘要），不出现时间线/Trace 等深度视图。
2. **Given** 一个高级/Debug 示例块显式开启高级观测，**When** 读者运行，**Then** 可切换查看深度观测数据，并能与运行的结果/错误形成可解释关联。

---

### Edge Cases

- 示例被编辑成死循环或长时间运行：必须可取消/超时并可恢复交互。
- 输出过多导致页面卡顿：输出必须有上限（例如按条数/体积截断），并提示被截断的事实。
- 多次连续运行：必须保证“上一轮运行”不会污染“下一轮结果”（包括输出、状态与观测数据）。
- 页面内存在多个 Playground：它们的运行与状态必须相互隔离。
- 文档中大量普通代码块：默认保持静态展示，不应被误判为可运行。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 文档系统 MUST 支持“作者显式标记”的可运行示例块；未标记的代码块 MUST 始终为静态展示。
- **FR-002**: 读者 MUST 能对单个示例块执行：运行、重新运行、取消运行、重置为初始示例内容。
- **FR-003**: 示例块 MUST 提供页面内编辑能力，并在运行前明确“将以当前编辑内容运行”。
- **FR-004**: 示例块 MUST 提供教学默认面板集合（例如说明/控制台/结果摘要/状态摘要），并允许作者选择默认显示哪些面板。
- **FR-005**: 作者 MUST 能为示例配置 1–3 条观察点；运行结果区 MUST 展示这些观察点，帮助读者知道“该看什么/是否符合预期”。
- **FR-006**: 作者 MUST 能将示例标记为“基础教学”或“高级/Debug”；只有高级/Debug 示例才可启用深度观测面板（例如时间线/Trace/事件摘要）。
- **FR-007**: 示例运行环境 MUST 与站点隔离，且 MUST 提供明确的安全边界（例如禁止访问宿主文件/凭据；默认不依赖外部网络以保证可复现）。
- **FR-008**: 系统 MUST 为每次运行产出结构化的运行结果摘要（成功/失败、耗时、关键输出），并对日志/观测数据提供有界缓存，避免无上限增长。
- **FR-009**: 系统 MUST 以“面向读者”的方式呈现错误（可理解摘要 + 可定位信息 + 恢复建议），并避免把内部实现细节直接暴露给普通教程读者。
- **FR-010**: 同一页面内多个示例块 MUST 彼此隔离：一个示例的编辑/运行/输出/观测不得影响其它示例块。
- **FR-011**: Playground 的交互文案与基础 UI MUST 支持站点国际化（至少中/英一致可用），并跟随当前文档语言切换。

### Non-Functional Requirements (Performance & Diagnosability)

- **NFR-001**: 在常见网络与设备条件下，包含教学 Playground 的文档页 MUST 在可接受时间内进入可交互状态（可滚动、可展开示例、可开始编辑/运行）。
- **NFR-002**: 对于代表性教学示例，用户触发运行后 MUST 在可接受时间内得到首屏反馈（例如立即进入运行态并出现实时输出/进度/可取消入口）。
- **NFR-003**: 运行过程 MUST 可取消且可恢复；取消后页面应回到可再次运行的稳定状态。
- **NFR-004**: 系统 MUST 使用确定性的运行标识与有序事件序列，使深度观测数据可对比、可复现、可解释（尤其在高级/Debug 文档中）。
- **NFR-005**: 当深度观测关闭时，教学默认体验的额外开销 MUST 可控（避免为“高级能力”付出全量成本）。

### Key Entities *(include if feature involves data)*

- **PlaygroundBlock**: 文档中的可运行示例单元；包含初始示例内容、面板默认配置、观察点、难度级别（基础/高级）。
- **RunResult**: 单次运行的结果摘要；包含成功/失败、耗时、输出摘要与（可选）深度观测数据引用。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 至少 3 篇代表性用户文档页面包含可运行示例块，读者可在页面内完成“运行 → 观察结果”的闭环，且无需离开文档站点。
- **SC-002**: 读者可在上述页面完成“编辑 → 重新运行 → 重置”全流程；重置后示例可恢复到可运行状态。
- **SC-003**: 普通教程默认只展示教学面板；时间线/Trace 等深度观测只在作者标记为高级/Debug 的示例中可见。
- **SC-004**: 对代表性示例，运行取消功能可用：用户触发取消后，示例在可接受时间内停止产生新输出并回到可再次运行的状态。
- **SC-005**: 在同一页面多示例块场景下，示例之间互不干扰；连续运行多次不会出现跨运行输出串扰或页面显著卡顿/崩溃。

## Assumptions

- 可运行示例由作者挑选与维护；默认假设文档页并不要求“所有代码片段都可执行”。
- 教学演示优先于“完整项目形态”；先保证单个示例块的闭环体验，再逐步扩展能力。

## Dependencies

- 需要一个可在浏览器中隔离执行示例并回传运行结果的基础设施（含编译/运行/日志与观测数据回传能力）。
- 文档系统需要提供作者侧的声明入口（用于标记可运行示例、观察点、默认面板与难度级别）。

## Out of Scope

- 生成完整项目脚手架、依赖安装、多人协作与一键分享链接等“线上 IDE”能力。
- 默认情况下对外部网络与外部服务的依赖；如确需网络交互，需在后续特性中单独定义复现策略与安全边界。
